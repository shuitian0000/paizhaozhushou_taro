# 任务：智能摄影助手微信小程序

## 计划
- [x] 步骤1：读取关键配置文件
- [x] 步骤2：初始化Supabase后端
- [x] 步骤3：设计配色系统
- [x] 步骤4：实现核心功能页面
- [x] 步骤5：实现数据库操作和图片上传
- [x] 步骤6：集成AI分析功能
- [x] 步骤7：配置路由和TabBar
- [x] 步骤8：代码检查和优化
- [x] 步骤9：修复Bug（第一轮）
- [x] 步骤10：实现本地评估算法和修复相机问题（第二轮）
- [x] 步骤11：优化用户体验和添加简略建议（第三轮）
  - [x] 页面加载时自动调用相机
  - [x] 优化占位区域显示（避免黑屏）
  - [x] 在各维度分数旁添加简略建议（不超过10字）
  - [x] camera页面和result页面都添加简略建议

## 完成情况
✅ 所有功能已实现完成
✅ 数据库表和存储桶已创建
✅ Edge Function已部署
✅ 所有页面已创建并配置
✅ TabBar图标已下载
✅ 代码检查通过
✅ Bug已修复（第三轮）：
  - 拍照助手进入页面时自动调用相机（使用useDidShow）
  - 优化占位区域UI，使用渐变背景和主题色，避免显示黑色
  - 在camera页面和result页面的各维度分数旁添加简略建议
  - 简略建议不超过10个字，简洁明了

## 功能说明

### 拍照助手（本地评估）
- **自动调用相机**：进入页面后500ms自动调用相机拍照
- **本地评估**：拍照后自动使用本地算法进行评估
- **实时显示**：
  - 综合评分（大号显示）
  - 各维度得分（进度条可视化）
  - **简略建议**：每个维度分数旁显示不超过10字的建议
  - 详细建议：展开显示完整的改进建议
- **无需网络**：完全本地评估，无需上传照片
- **可选保存**：可以保存评估结果到云端

### 照片评估（AI评估）
- 选择照片后点击"开始分析"
- 使用文心一言AI分析照片
- **评估结果显示**：
  - 综合评分
  - 各维度得分（构图、姿态、角度、距离、高度）
  - **简略建议**：每个维度分数旁显示不超过10字的建议
  - 详细建议：每个维度的具体改进建议
- 自动保存评估记录

### 历史记录
- 查看所有评估记录
- 按类型筛选（实时拍摄/上传照片）
- 点击记录查看详情

## 简略建议规则

### 构图（30分）
- < 20分：构图需优化
- 20-24分：可调整主体
- ≥ 25分：构图良好

### 姿态（30分）
- < 20分：姿态欠佳
- 20-24分：可调整姿势
- ≥ 25分：姿态自然

### 角度（20分）
- < 12分：角度欠佳
- 12-15分：可换视角
- ≥ 16分：角度合适

### 距离（10分）
- < 6分：距离不当
- 6-7分：可调距离
- ≥ 8分：距离适中

### 高度（10分）
- < 6分：光线不足
- 6-7分：曝光欠佳
- ≥ 8分：光线良好

## 用户体验优化

### 自动调用相机
- 使用`useDidShow` Hook监听页面显示
- 首次进入页面时自动调用相机
- 延迟500ms确保页面已渲染
- 用户取消拍照不显示错误提示

### 占位区域优化
- 使用`bg-gradient-subtle`渐变背景
- 使用`border-primary/30`主题色边框
- 相机图标使用`text-primary`主题色
- 避免显示黑色，提供友好的视觉反馈

### 简略建议显示
- 位置：分数右侧，用灰色小字显示
- 长度：不超过10个字
- 内容：简洁明了，直接指出问题或肯定优点
- 样式：`text-xs text-muted-foreground`

## 技术实现

### 自动调用相机
```typescript
const hasAutoCalledRef = useRef(false)

useDidShow(() => {
  if (!hasAutoCalledRef.current && !currentImage) {
    hasAutoCalledRef.current = true
    setTimeout(() => {
      takePhoto()
    }, 500)
  }
})
```

### 简略建议生成
```typescript
const getShortSuggestion = (dimension: string, score: number): string => {
  switch (dimension) {
    case 'composition':
      if (score < 20) return '构图需优化'
      if (score < 25) return '可调整主体'
      return '构图良好'
    // ... 其他维度
  }
}
```

### 简略建议显示
```typescript
<View className="flex flex-row items-center">
  <Text className="text-xs text-muted-foreground mr-2">
    {getShortSuggestion('composition', evaluation.composition_score)}
  </Text>
  <Text className={`text-lg font-bold ${getScoreColor(score)}`}>
    {score}/30
  </Text>
</View>
```

## 注意事项
- 拍照助手使用本地算法，评估速度快，无需网络
- 照片评估使用AI分析，需要网络连接
- 本地算法基于图像处理技术，准确度略低于AI
- 评分维度：构图30%、姿态30%、角度20%、距离10%、高度10%
- 简略建议和详细建议互补，提供完整的评估反馈
- 自动调用相机仅在首次进入页面时触发，避免重复调用


