# 智能摄影助手 - 使用指南

## 快速开始

### 在微信开发者工具中测试

#### 步骤1：打开项目
```bash
# 在微信开发者工具中打开项目
# 项目路径：/workspace/app-8l12za1oblz5
```

#### 步骤2：进入拍照助手页面
1. 点击底部TabBar的"首页"
2. 点击"拍照助手"卡片

#### 步骤3：等待超时检测
- 页面会显示"相机初始化中...WEAPP|isWeApp: 是"
- 等待5秒后会弹出提示框

#### 步骤4：选择降级方案
- 点击"使用备用方案"
- 进入降级模式
- 点击"调用相机拍照"按钮
- 拍照后自动评估

### 在真机上测试（推荐）

#### 步骤1：启动真机调试
1. 打开微信开发者工具
2. 点击工具栏的"真机调试"按钮
3. 使用微信扫描二维码

#### 步骤2：授权相机权限
- 首次使用会弹出授权请求
- 点击"允许"授予相机权限

#### 步骤3：体验实时预览
- "相机初始化中..."提示会在1秒内消失
- 看到实时相机预览
- 看到实时建议浮层
- 建议每2秒更新一次

#### 步骤4：拍照并评估
- 点击底部的拍摄按钮
- 自动进行评估
- 查看评估结果
- 可以保存或重新拍照

## 功能说明

### 实时预览模式（真机专属）

**特点**：
- ✅ 实时相机预览
- ✅ 每2秒自动采集镜头
- ✅ 实时显示建议
- ✅ 高质量拍照

**实时建议规则**：
- **构图**：< 20分显示"需优化主体位置"，20-24分显示"可调整主体"
- **角度**：< 12分显示"建议换个视角"，12-15分显示"可尝试其他角度"
- **距离**：< 6分显示"需调整拍摄距离"
- **光线**：< 6分显示"光线不足"，6-7分显示"曝光欠佳"
- **良好**：所有维度都良好时显示"画面良好，可以拍摄"

### 降级方案模式（开发者工具）

**特点**：
- ✅ 使用系统相机
- ✅ 手动拍照
- ✅ 自动评估
- ❌ 无实时建议

**适用场景**：
- 在开发者工具中测试
- Camera组件不可用时
- 快速测试评估功能

### 照片评估模式

**特点**：
- ✅ 上传照片
- ✅ AI评估（文心一言）
- ✅ 详细建议
- ✅ 保存记录

**评分维度**：
- 构图（30%）：基于三分法、黄金螺旋等构图理论
- 人物姿态（30%）：姿态自然度、表情状态
- 拍摄角度（20%）：角度新颖性、主体突出度
- 拍摄距离（10%）：主体清晰度、环境协调度
- 机位高度（10%）：视角选择合理性

## 常见问题

### Q1：为什么一直显示"相机初始化中..."？

**A**：Camera组件在微信开发者工具中不完全支持，这是微信官方的限制。

**解决方案**：
1. **推荐**：使用真机调试（点击"真机调试"按钮）
2. **备选**：等待5秒后使用降级方案

### Q2：如何使用真机调试？

**A**：
1. 打开微信开发者工具
2. 点击工具栏的"真机调试"按钮
3. 使用微信扫描二维码
4. 在手机上打开小程序

### Q3：真机调试需要什么条件？

**A**：
1. 手机安装了微信
2. 手机和电脑在同一网络
3. 小程序已经配置了AppID
4. 开发者账号有权限

### Q4：降级方案和实时预览有什么区别？

**A**：
| 功能 | 实时预览 | 降级方案 |
|------|---------|---------|
| 环境 | 真机 | 开发者工具/真机 |
| 实时建议 | ✅ 每2秒更新 | ❌ 无 |
| 拍照方式 | Camera组件 | 系统相机 |
| 评估功能 | ✅ | ✅ |

### Q5：如何查看日志？

**A**：
1. 打开微信开发者工具
2. 点击"Console"标签
3. 查看日志输出

**日志标记说明**：
- 📱 页面事件
- 🎉 重要事件
- ✅ 成功操作
- ❌ 失败操作
- ⏰ 定时器
- 📸 拍照相关
- 💡 建议相关

### Q6：5秒超时可以调整吗？

**A**：可以，但不建议。如果确实需要，可以修改代码：

```typescript
// 在 src/pages/camera/index.tsx 中
// 找到这一行（第40行左右）
initTimeoutRef.current = setTimeout(() => {
  // ...
}, 5000)  // 修改这个数字（单位：毫秒）
```

### Q7：如何跳过超时检测直接使用降级方案？

**A**：在首页点击"照片评估"而不是"拍照助手"，或者等待5秒后选择"使用备用方案"。

### Q8：真机上也显示"相机初始化中..."怎么办？

**A**：可能的原因：
1. **权限未授予**：检查是否允许了相机权限
2. **网络问题**：确保手机和电脑在同一网络
3. **微信版本**：更新微信到最新版本

**解决步骤**：
1. 退出小程序
2. 重新扫描二维码
3. 允许相机权限
4. 重新进入拍照助手页面

## 技术细节

### Camera组件限制

**微信官方文档说明**：
> camera 是原生组件，使用时请注意相关限制。
> 在开发者工具中，camera 组件可能无法正常显示和使用，建议使用真机调试。

**具体表现**：
- onReady事件在开发者工具中可能不触发
- 无法创建有效的CameraContext
- 需要真机环境才能完整测试

### 超时检测机制

**设计思路**：
1. 页面显示后启动5秒倒计时
2. 如果5秒后Camera还没准备好，弹出提示框
3. 用户可以选择"使用备用方案"或"继续等待"
4. 如果选择"继续等待"，再等待5秒后自动切换

**代码位置**：
- `src/pages/camera/index.tsx` 第38-66行

### 降级方案实现

**使用API**：
- `Taro.chooseImage`：调用系统相机或相册

**参数配置**：
```typescript
Taro.chooseImage({
  count: 1,                    // 只选择1张
  sizeType: ['compressed'],    // 压缩图片
  sourceType: ['camera']       // 只允许拍照
})
```

### 权限配置

**位置**：`src/app.config.ts`

**配置内容**：
```typescript
permission: {
  'scope.camera': {
    desc: '需要使用您的摄像头进行拍照和实时预览'
  }
}
```

**作用**：
- 声明小程序需要相机权限
- 首次使用时弹出授权请求
- 用户必须授权才能使用Camera组件

## 开发建议

### 测试流程

1. **开发阶段**
   - 使用真机调试测试Camera功能
   - 使用降级方案快速测试评估功能

2. **功能测试**
   - 测试实时预览：真机调试
   - 测试评估算法：降级方案
   - 测试UI交互：开发者工具

3. **性能测试**
   - 测试实时评估性能：真机调试
   - 测试内存占用：真机调试
   - 测试电池消耗：真机调试

### 调试技巧

1. **查看日志**
   - 打开Console
   - 搜索emoji标记（📱🎉✅❌）
   - 追踪执行流程

2. **问题定位**
   - 如果看到"🎉 Camera组件onReady回调被触发"，说明Camera正常
   - 如果5秒后弹出提示框，说明Camera不支持
   - 如果看到"❌"标记，说明有错误

3. **性能监控**
   - 查看定时器ID
   - 监控内存使用
   - 检查是否有内存泄漏

## 总结

### 核心功能

1. ✅ **实时预览**（真机）：Camera组件 + 每2秒采集 + 实时建议
2. ✅ **降级方案**（开发者工具）：系统相机 + 手动拍照 + 评估
3. ✅ **照片评估**：上传照片 + AI评估 + 详细建议
4. ✅ **历史记录**：查看所有评估记录

### 使用建议

1. **真机调试**：完整体验实时预览功能
2. **降级方案**：快速测试评估功能
3. **查看日志**：快速定位问题
4. **阅读文档**：了解技术细节

### 相关文档

- `CAMERA_DEVTOOLS_ISSUE.md`：Camera组件问题完整分析
- `CAMERA_INIT_PROBLEM.md`：初始化问题分析
- `BUG_ANALYSIS_REALTIME.md`：实时评估Bug分析
- `TODO.md`：项目进度和功能说明

现在您可以开始使用智能摄影助手了！
