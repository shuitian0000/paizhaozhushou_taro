# 微信小程序隐私保护指引配置说明

## 概述

为了通过微信小程序审核，需要在小程序管理后台配置用户隐私保护指引。本文档说明如何配置。

## 配置步骤

### 1. 登录微信小程序管理后台

访问：https://mp.weixin.qq.com/

### 2. 进入隐私保护指引设置

路径：**设置** → **基本设置** → **服务内容声明** → **用户隐私保护指引**

### 3. 填写隐私保护指引

点击"设置"按钮，填写以下内容：

#### 3.1 隐私保护指引名称
```
用户隐私保护指引
```

#### 3.2 隐私保护指引内容

可以参考项目根目录的 `PRIVACY_POLICY.md` 文件内容，或使用以下简化版本：

```
【引言】
欢迎使用智能摄影助手！我们非常重视您的隐私保护。

【我们收集的信息】
1. 相册权限（仅写入）：用于保存拍摄的照片到您的相册
2. 摄像头权限：用于拍照助手的实时预览和拍摄功能
3. 选择图片权限：用于照片评估功能上传照片

【我们如何使用信息】
- 所有照片评估均在本地完成，不会上传照片到服务器
- 仅保存评估结果，不保存照片URL或照片内容
- 收集匿名使用统计数据用于改进产品

【我们如何保护您的信息】
- 不上传或保存您的照片到云端
- 使用加密技术保护数据传输
- 严格的访问控制确保数据安全

【您的权利】
- 可以随时查看和删除评估记录
- 可以在系统设置中撤回授权的权限

【联系我们】
如有疑问，请通过小程序内"建议和吐槽"功能联系我们。

最后更新：2025年1月4日
```

### 4. 声明使用的隐私接口

在"用户信息类型"部分，勾选以下接口：

- ✅ **选择图片或视频** (chooseImage / chooseMedia)
  - 用途说明：用于照片评估功能，用户选择照片进行分析
  
- ✅ **保存图片到相册** (saveImageToPhotosAlbum)
  - 用途说明：用于拍照助手功能，保存拍摄的照片到用户相册
  
- ✅ **摄像头** (camera)
  - 用途说明：用于拍照助手功能，实时预览和拍摄照片

### 5. 保存并提交审核

完成配置后，点击"保存"按钮。

## 代码配置说明

### 已完成的代码配置

1. **app.config.ts**：
   - 添加了 `__usePrivacyCheck__: true`
   - 配置了 `requiredPrivateInfos` 数组

2. **project.config.json**：
   - 添加了 `__usePrivacyCheck__: true`

3. **PrivacyModal组件**：
   - 监听 `onNeedPrivacyAuthorization` 事件
   - 在用户使用隐私接口前弹出授权弹窗
   - 用户同意后才能使用相关功能

### 测试隐私弹窗

1. 在微信开发者工具中打开项目
2. 点击"清除缓存" → "清除授权数据"
3. 重新运行小程序
4. 当使用拍照助手或照片评估功能时，会弹出隐私保护指引

## 注意事项

1. **首次使用**：用户首次使用涉及隐私接口的功能时，会自动弹出隐私保护指引
2. **用户拒绝**：如果用户拒绝授权，会提示"您需要同意隐私保护指引才能使用小程序的完整功能"
3. **再次授权**：用户可以在小程序右上角菜单 → "设置" → "隐私设置"中重新授权

## 审核要点

微信小程序审核时会检查：

1. ✅ 是否在管理后台配置了隐私保护指引
2. ✅ 是否声明了使用的隐私接口
3. ✅ 隐私保护指引内容是否完整、清晰
4. ✅ 代码中是否正确实现了隐私授权流程
5. ✅ 用户拒绝授权后是否有合理的提示

## 常见问题

### Q1: 审核被拒，提示"未完善用户隐私保护指引"
**A**: 请确保在管理后台完成了隐私保护指引的配置，并声明了所有使用的隐私接口。

### Q2: 隐私弹窗不显示
**A**: 
- 检查 `app.config.ts` 和 `project.config.json` 中的配置是否正确
- 清除授权数据后重新测试
- 确保在微信开发者工具中启用了"隐私接口检测"

### Q3: 用户拒绝授权后如何处理
**A**: 
- 代码中已实现：显示提示信息，引导用户重新授权
- 用户可以在小程序设置中重新授权

## 相关文档

- [微信小程序隐私保护指引官方文档](https://developers.weixin.qq.com/miniprogram/dev/framework/user-privacy/)
- [隐私接口列表](https://developers.weixin.qq.com/miniprogram/dev/framework/user-privacy/PrivacyAuthorize.html)
